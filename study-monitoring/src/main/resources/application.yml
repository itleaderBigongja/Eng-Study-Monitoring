# study-monitoring/src/main/resources/application.yml
server:
  port: 8081

spring:
  application:
    name: study-monitoring

  # Postgres DB JDBC ì—°ê²°
  datasource:
    url: jdbc:postgresql://localhost:5432/DEV_DB
    username: rnbsoft
    password: rnbsoft
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 20           # ìµœëŒ€ ì—°ê²° ìˆ˜: 20ê°œ
      minimum-idle: 5                 # ìµœì†Œ ìœ íœ´ ì—°ê²°: 5ê°œ
      connection-timeout: 30000       # ì—°ê²° íƒ€ì„ì•„ì›ƒ: 30ì´ˆ
      idle-timeout: 600000
      max-lifetime: 1800000           # ìµœëŒ€ ìˆ˜ëª… 30ë¶„


  # MyBatis ì„¤ì •
  mybatis:
    mapper-locations: classpath:mapper/**/*.xml                           # XML ë§¤í¼ ìœ„ì¹˜: xmlíŒŒì¼ì„ ì½ì„ ìœ„ì¹˜
    type-aliases-package: com.study.monitoring.studymonitoring.model.vo   # vo íŒ¨í‚¤ì§€ ê²½ë¡œ
    configuration:
      map-underscore-to-camel-case: true                                  # í¸ì˜ ì„¤ì •: DBì˜ Snake_case ì»¬ëŸ¼ì„ Javaì˜ CamelCase í•„ë“œë¡œ ìë™ ë§¤í•‘


  # ë¹„ë™ê¸° ì²˜ë¦¬ ì„¤ì •( ì„œë¹„ìŠ¤ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ì„œ @Async ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì¸ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ë•Œ, ìŠ¤ë ˆë“œ ì„¤ì •ì´ ì¡í˜ )
  task:
    execution:
      pool:
        core-size: 10              # ê¸°ë³¸ ìŠ¤ë ˆë“œ ìˆ˜
        max-size: 50               # ìµœëŒ€ ìŠ¤ë ˆë“œ ìˆ˜( íŠ¸ë˜í”½ ì¦ê°€ ì‹œ ìµœëŒ€ í™•ì¥ ê°€ëŠ¥í•œ ìŠ¤ë ˆë“œ ìˆ˜ )
        queue-capacity: 100        # í í¬ê¸°( ìŠ¤ë ˆë“œê°€ ëª¨ë‘ ì°¼ì„ ë•Œ ëŒ€ê¸°ì—´ í¬ê¸° )
        keep-alive: 60s            # ìœ íœ´ ìŠ¤ë ˆë“œ ìœ ì§€ ì‹œê°„
      thread-name-prefix: async-   # ìŠ¤ë ˆë“œ ì´ë¦„ prefix


# Elasticsearch ì—°ê²°( ë¡œê·¸ ê²€ìƒ‰ ë° ì €ì¥ì„ ìœ„í•œ ì—”ì§„ ì—°ê²° )
elasticsearch:
  host: localhost
  port: 9200

# Prometheus ì—°ê²°( ì‹œê³„ì—´ ë©”íŠ¸ë¦­ ë°ì´í„° ìˆ˜ì§‘ ì„œë²„ ì—°ê²° )
# http://prometheus-service.monitoring.svc.cluster.local:9090
prometheus:
  url: http://localhost:9090

# ============================================================================
# ğŸ”” Slack ì•Œë¦¼ ì„¤ì • (ì‹ ê·œ ì¶”ê°€)
# ============================================================================
slack:
  webhook-url: ${SLACK_WEBHOOK_URL}
  # âš ï¸ ì‹¤ì œ Slack Webhook URLë¡œ ë³€ê²½ í•„ìš”!
  # Slack ì•± ìƒì„± ë°©ë²•:
  # 1. https://api.slack.com/apps ì ‘ì†
  # 2. "Create New App" í´ë¦­
  # 3. "From scratch" ì„ íƒ
  # 4. ì•± ì´ë¦„ ì…ë ¥ (ì˜ˆ: Monitoring Alert)
  # 5. Workspace ì„ íƒ
  # 6. "Incoming Webhooks" í™œì„±í™”
  # 7. "Add New Webhook to Workspace" í´ë¦­
  # 8. ì•Œë¦¼ ë°›ì„ ì±„ë„ ì„ íƒ (ì˜ˆ: #monitoring)
  # 9. ìƒì„±ëœ Webhook URL ë³µì‚¬í•˜ì—¬ ìœ„ì— ë¶™ì—¬ë„£ê¸°


# ë°°ì¹˜ ì‘ì—… ìŠ¤ì¼€ì¤„ ì„¤ì •( ë°°ì¹˜ë¥¼ ìƒì„±í•˜ì—¬ ëª¨ë‹ˆí„°ë§ì— ëŒ€í•œ schduleì„ ì¡ì„ ë•Œ ì‚¬ìš© )
monitoring:
  batch:
    statistics-aggregation-cron: "0 */5 * * * *"  # 5ë¶„ë§ˆë‹¤ ì‹¤í–‰(5ë¶„ë™ì•ˆ í‰ê·  CPU ì‚¬ìš©ëŸ‰ì²˜ëŸ¼ í•œ ì¤„ë¡œ ìš”ì•½)
    data-cleanup-cron: "0 0 2 * * *"              # ë§¤ì¼ ìƒˆë²½ 2ì‹œ ì‹¤í–‰( ìœ íš¨ê¸°ê°„ì´ ì§€ë‚œ ë°ì´í„° DBì—ì„œ ì‚­ì œ )
  retention:
    prometheus-days: 30       # Prometheus ë³´ê´€ ê¸°ê°„
    statistics-days: 90       # PostgreSQL í†µê³„ ë°ì´í„° ë³´ê´€ ê¸°ê°„ (90ì¼)
    event-days: 30            # ì´ë²¤íŠ¸ ë°ì´í„° ë³´ê´€ ê¸°ê°„ (30ì¼)
    error-days: 30            # ì—ëŸ¬ ë°ì´í„° ë³´ê´€ ê¸°ê°„ (30ì¼)


# Actuator ì„¤ì •
management:
  endpoints:
    web:
      exposure:
        include: health, info, prometheus, metrics
        # ë…¸ì¶œ ì—”ë“œí¬ì¸íŠ¸ ì„¤ì •( Prometheus ì„œë²„ê°€ ì£¼ê¸°ì ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ /actuator/prometheus ì£¼ì†Œì— ì ‘ì†( CPU, TPS, Error ë“± ) ìˆ˜ì§‘ )
        # ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ /actuator/health ì£¼ì†Œë¥¼ í˜¸ì¶œí•œë‹¤.
        # ì„œë²„ì˜ í˜„ì¬ ë²„ì „ ë˜ëŠ” ë¹Œë“œ ì •ë³´ë¥¼ ë³´ì—¬ì¤€ë‹¤.
        # Prometheus ì „ìš© ë²ˆì—­ => Prometheusê°€ JSONì„ ì½ì§€ ëª»í•´ì„œ, Springì´ ê°€ì§„ ë°ì´í„°ë¥¼ Prometheusê°€ ì½ì„ìˆ˜ ìˆë„ë¡ í…ìŠ¤íŠ¸ í¬ë§·ì„ í•œë‹¤.
        # Spring Bootê°€ ë‚´ë¶€ì ìœ¼ë¡œ ê°€ì§€ê³  ìˆëŠ” ëª¨ë“  ìˆ˜ì¹˜ ë°ì´í„°(Metric)ì˜ ëª©ë¡ì„ ë³´ì—¬ì¤€ë‹¤.
  endpoint:
    health:
    show-details: always     # ìƒì„¸ ì •ë³´ í‘œì‹œ í•­ìƒ(always) == ì–´ë–¤ Podì˜ ìƒíƒœ( UP/DOWN )
  metrics:
    export:
      prometheus:            # Prometheus Scrape í™œì„±í™”
        enabled : true       # -> Prometheusê°€ ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë©”íŠ¸ë¦­ì„ ê¸ì–´ê°ˆ ìˆ˜ ìˆë„ë¡ í—ˆìš©

# ë¡œê¹… ì„¤ì •
logging:
  level:
    root: INFO
    com.study.monitoring: DEBUG
    org.springframework.scheduling: INFO  # ìŠ¤ì¼€ì¤„ë§ ë¡œê·¸
    org.springframework.web.client: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"